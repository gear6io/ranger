name: ErrorCode Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch: # Allow manual triggering

jobs:
  errorcode-check:
    name: Check ErrorCodes and Error Patterns in Server Packages
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
        cache: true
        
    - name: Run ErrorCode checker on server packages
      run: |
        echo "üîç Running ErrorCode checker on server packages..."
        make check-errorcodes
        
    - name: Comment PR with results
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: `## ErrorCode Check Results
              
              ‚úÖ **All checks passed!**
              
              - All ErrorCodes in server packages are being used
              - No forbidden error patterns found in server packages
              
              ---
              *This comment was automatically generated by the ErrorCode checker*`
          });
